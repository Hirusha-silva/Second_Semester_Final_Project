<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpareWay | Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f9fafc; font-family: 'Segoe UI', sans-serif; }

        /* Header */
        .navbar-brand { font-weight: bold; font-size: 1.4rem; }

        /* Search Card */
        .search-card {
            background: #fff;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0px 4px 15px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }
        .search-card h2 { font-weight: 700; color: #333; }
        .search-card input,
        .search-card select {
            border-radius: 12px;
            padding: 10px;
        }
        .search-card button {
            border-radius: 12px;
            font-weight: 600;
        }

        /* Ad Card */
        .ad-card {
            transition: 0.3s;
            cursor: pointer;
            border-radius: 15px;
            overflow: hidden;
        }
        .ad-card:hover { transform: translateY(-5px); box-shadow: 0px 6px 18px rgba(0,0,0,0.15); }
        .ad-card img { height: 180px; object-fit: cover; }
        .ad-card .card-body { position: relative; }
        .fav-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            border: none;
            border-radius: 50%;
            padding: 6px 9px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: 0.2s;
        }
        .fav-btn.active { color: red; }

        /* Section Tabs */
        .section-tabs .nav-link {
            font-weight: 600;
            border-radius: 10px;
            margin-right: 10px;
        }
        .section-tabs .nav-link.active {
            background-color: #007bff;
            color: white !important;
        }
    </style>
</head>
<body>

<!-- üîù Header -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="#">SpareWay</a>
        <button class="btn btn-success ms-auto" data-bs-toggle="modal" data-bs-target="#postAdModal">
            + Post Ad
        </button>
    </div>
</nav>

<div class="container mt-4">

    <!-- üîé Modern Search -->
    <div class="search-card">
        <h2 class="mb-3">üîç Find Spare Parts</h2>
        <form id="searchForm" class="row g-3">
            <div class="col-md-4">
                <input type="text" id="searchKeyword" class="form-control" placeholder="Search by keyword...">
            </div>
            <div class="col-md-2">
                <select id="searchCategory" class="form-select">
                    <option value="">Category</option>
                    <option value="Engine Parts">Engine Parts</option>
                    <option value="Tyres">Tyres</option>
                    <option value="Brakes">Brakes</option>
                    <option value="Car">Car</option>
                    <option value="Bike">Bike</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div class="col-md-2">
                <select id="searchBrand" class="form-select">
                    <option value="">Brand</option>
                    <option value="Toyota">Toyota</option>
                    <option value="Honda">Honda</option>
                    <option value="Nissan">Nissan</option>
                </select>
            </div>
            <div class="col-md-2">
                <select id="searchModel" class="form-select">
                    <option value="">Model</option>
                    <option value="Corolla">Corolla</option>
                    <option value="Civic">Civic</option>
                    <option value="Sunny">Sunny</option>
                </select>
            </div>
            <div class="col-md-2">
                <input type="number" id="minPrice" class="form-control" placeholder="Min Price">
            </div>
            <div class="col-md-2">
                <input type="number" id="maxPrice" class="form-control" placeholder="Max Price">
            </div>
            <div class="col-md-2">
                <input type="text" id="searchLocation" class="form-control" placeholder="Location">
            </div>
            <div class="col-md-2 d-grid">
                <button type="submit" class="btn btn-primary">Search</button>
            </div>
        </form>
    </div>

    <!-- üìÇ Tabs for Sections -->
    <ul class="nav nav-pills mb-4 section-tabs" id="adsTabs">
        <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#allAds">All Ads</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#myAds">My Ads</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#favAds">Favorites ‚ù§Ô∏è</a></li>
    </ul>

    <!-- üì¶ Ads Display -->
    <div class="tab-content">
        <div class="tab-pane fade show active" id="allAds">
            <div class="row" id="adsContainer"></div>
        </div>
        <div class="tab-pane fade" id="myAds">
            <div class="row" id="myAdsContainer"></div>
        </div>
        <div class="tab-pane fade" id="favAds">
            <div class="row" id="favAdsContainer"></div>
        </div>
    </div>
</div>

<!-- üìù Post Ad Modal -->
<div class="modal fade" id="postAdModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">Post a New Ad</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="adForm">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Ad Title</label>
                            <input type="text" class="form-control" id="title" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Price</label>
                            <input type="number" class="form-control" id="price" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Category</label>
                            <select class="form-select" id="category" required>
                                <option value="">Choose...</option>
                                <option value="Car">Car</option>
                                <option value="Bike">Bike</option>
                                <option value="Parts">Parts</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Location</label>
                            <input type="text" class="form-control" id="location" required>
                        </div>
                        <div class="col-md-12">
                            <label class="form-label">Upload Photos (Multiple)</label>
                            <input type="file" class="form-control" id="photos" accept="image/*" multiple required>
                        </div>
                        <div class="col-md-12">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" id="description" rows="3" required></textarea>
                        </div>
                    </div>
                    <div class="text-end mt-3">
                        <button type="submit" class="btn btn-success">Post Ad</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- ü™ü View Ad Modal -->
<div class="modal fade" id="adModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white">
                <h5 class="modal-title" id="modalTitle"></h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="photoCarousel" class="carousel slide mb-3" data-bs-ride="carousel">
                    <div class="carousel-inner" id="carouselImages"></div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#photoCarousel" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon"></span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#photoCarousel" data-bs-slide="next">
                        <span class="carousel-control-next-icon"></span>
                    </button>
                </div>
                <h6 class="text-success">Price: Rs. <span id="modalPrice"></span></h6>
                <p><b>Category:</b> <span id="modalCategory"></span></p>
                <p><b>Location:</b> <span id="modalLocation"></span></p>
                <p id="modalDescription"></p>
            </div>
        </div>
    </div>
</div>

<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const adsContainer = document.getElementById('adsContainer');
    const myAdsContainer = document.getElementById('myAdsContainer');
    const favAdsContainer = document.getElementById('favAdsContainer');

    const adModal = new bootstrap.Modal(document.getElementById('adModal'));
    const modalTitle = document.getElementById('modalTitle');
    const modalPrice = document.getElementById('modalPrice');
    const modalDescription = document.getElementById('modalDescription');
    const modalCategory = document.getElementById('modalCategory');
    const modalLocation = document.getElementById('modalLocation');
    const carouselImages = document.getElementById('carouselImages');

    const searchForm = document.getElementById('searchForm');
    const keywordInput = document.getElementById('searchKeyword');
    const categoryFilter = document.getElementById('searchCategory');
    const brandFilter = document.getElementById('searchBrand');
    const modelFilter = document.getElementById('searchModel');
    const minPrice = document.getElementById('minPrice');
    const maxPrice = document.getElementById('maxPrice');
    const locationFilter = document.getElementById('searchLocation');

    let ads = [];
    let favAds = [];
    let myAds = [];

    // ‚úÖ Post New Ad
    document.getElementById('adForm').addEventListener('submit', function (e) {
        e.preventDefault();

        const title = document.getElementById('title').value;
        const price = parseFloat(document.getElementById('price').value);
        const description = document.getElementById('description').value;
        const category = document.getElementById('category').value;
        const location = document.getElementById('location').value;
        const photos = document.getElementById('photos').files;

        if (photos.length === 0) return alert("Please upload at least one photo!");

        let photoArray = [];
        let loaded = 0;

        for (let i = 0; i < photos.length; i++) {
            const reader = new FileReader();
            reader.onload = function (e) {
                photoArray.push(e.target.result);
                loaded++;
                if (loaded === photos.length) {
                    const ad = { title, price, description, category, location, photos: photoArray };
                    ads.push(ad);
                    myAds.push(ad);
                    displayAds();
                    document.getElementById('adForm').reset();
                    document.querySelector('#postAdModal .btn-close').click();
                }
            };
            reader.readAsDataURL(photos[i]);
        }
    });

    // ‚úÖ Display Ads
    function displayAds() {
        renderAds(ads, adsContainer, true);
        renderAds(myAds, myAdsContainer, false);
        renderAds(favAds, favAdsContainer, false);
    }

    function renderAds(list, container, showFavBtn) {
        container.innerHTML = '';
        let filtered = list.filter(ad => {
            const keyword = keywordInput.value.toLowerCase();
            const category = categoryFilter.value;
            const brand = brandFilter.value;
            const model = modelFilter.value;
            const min = minPrice.value ? parseFloat(minPrice.value) : 0;
            const max = maxPrice.value ? parseFloat(maxPrice.value) : Infinity;
            const location = locationFilter.value.toLowerCase();

            return (
                (ad.title.toLowerCase().includes(keyword) || ad.description.toLowerCase().includes(keyword)) &&
                (category === '' || ad.category === category) &&
                (ad.price >= min && ad.price <= max) &&
                (location === '' || ad.location.toLowerCase().includes(location))
            );
        });

        filtered.forEach((ad, index) => {
            const adCard = document.createElement('div');
            adCard.className = 'col-md-4 mb-4';
            adCard.innerHTML = `
        <div class="card ad-card">
          <img src="${ad.photos[0]}" class="card-img-top" alt="Ad Photo">
          <div class="card-body">
            <h5 class="card-title">${ad.title}</h5>
            <p class="card-text text-success fw-bold">Rs. ${ad.price}</p>
            <p class="text-muted"><small>${ad.category} | ${ad.location}</small></p>
            ${showFavBtn ? `<button class="fav-btn ${favAds.includes(ad) ? 'active' : ''}" onclick="toggleFav(event, ${ads.indexOf(ad)})">‚ô•</button>` : ''}
          </div>
        </div>
      `;
            adCard.querySelector('.card').addEventListener('click', () => viewAd(ads.indexOf(ad)));
            container.appendChild(adCard);
        });
    }

    // ‚úÖ Show Ad in Modal
    window.viewAd = function (index) {
        const ad = ads[index];
        modalTitle.textContent = ad.title;
        modalPrice.textContent = ad.price;
        modalDescription.textContent = ad.description;
        modalCategory.textContent = ad.category;
        modalLocation.textContent = ad.location;

        carouselImages.innerHTML = "";
        ad.photos.forEach((photo, i) => {
            carouselImages.innerHTML += `
        <div class="carousel-item ${i === 0 ? 'active' : ''}">
          <img src="${photo}" class="d-block w-100 rounded">
        </div>
      `;
        });
        adModal.show();
    };

    // ‚úÖ Toggle Favorites
    window.toggleFav = function (e, index) {
        e.stopPropagation();
        const ad = ads[index];
        if (favAds.includes(ad)) {
            favAds = favAds.filter(f => f !== ad);
        } else {
            favAds.push(ad);
        }
        displayAds();
    };

    // ‚úÖ Search form submit
    searchForm.addEventListener('submit', function(e) {
        e.preventDefault();
        displayAds();
    });
</script>
</body>
</html>
